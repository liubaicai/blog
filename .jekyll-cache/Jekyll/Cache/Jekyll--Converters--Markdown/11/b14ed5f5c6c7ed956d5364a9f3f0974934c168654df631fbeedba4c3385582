I"¨<h3>å®‰è£…å¥½elasticsearch</h3>
<p><br /></p>
<p><a href="http://www.liubaicai.net/articles/747">http://www.liubaicai.net/articles/747</a>&nbsp;æœ‰ä»‹ç»&lt;/p&gt;<p><br /></p><h3>é¦–å…ˆå¼•å…¥gem</h3><p><br /></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><span style="font-style:italic;">gem </span><span style="color:#008000;font-weight:bold;">'elasticsearch-model'<br /></span><span style="font-style:italic;">gem </span><span style="color:#008000;font-weight:bold;">'elasticsearch-rails'<br /></span><span style="font-style:italic;">gem </span><span style="color:#008000;font-weight:bold;">'elasticsearch-persistence'</span></pre><p>ç„¶åæ–°å»ºä¸€ä¸ªlib/tasks/elasticssearch.rakeä¸­&lt;/p&gt;<pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><span style="font-style:italic;">require </span><span style="color:#008000;font-weight:bold;">'elasticsearch/rails/tasks/import'</span></pre><h3><br /></h3><h3>ä¸ºæ•°æ®åº“è¡¨æ·»åŠ ç´¢å¼•çš„è¿ç§»</h3><p><br /></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><span style="color:#000080;font-weight:bold;">class </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">AddIndexsToArticles </span>&lt; <span style="color:#660e7a;font-weight:bold;font-style:italic;">ActiveRecord</span>::<span style="color:#660e7a;font-weight:bold;font-style:italic;">Migration<br /></span><span style="color:#660e7a;font-weight:bold;font-style:italic;">  </span><span style="color:#000080;font-weight:bold;">def </span><span style="color:#0000ff;font-style:italic;">change<br /></span><span style="color:#0000ff;font-style:italic;">    </span><span style="font-style:italic;">add_index </span><span style="color:#660e7a;font-weight:bold;">:articles</span>, <span style="color:#660e7a;font-weight:bold;">:title<br /></span><span style="color:#660e7a;font-weight:bold;">    </span><span style="font-style:italic;">add_index </span><span style="color:#660e7a;font-weight:bold;">:articles</span>, <span style="color:#660e7a;font-weight:bold;">:content<br /></span><span style="color:#660e7a;font-weight:bold;">  </span><span style="color:#000080;font-weight:bold;">end<br /></span><span style="color:#000080;font-weight:bold;">end</span></pre><h3><br /></h3><h3>æ‰©å±•modelç±»&lt;/h3&gt;<p><br /></p><pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><span style="color:#000080;font-weight:bold;">class </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">Article </span>&lt; <span style="color:#660e7a;font-weight:bold;font-style:italic;">ActiveRecord</span>::<span style="color:#660e7a;font-weight:bold;font-style:italic;">Base<br /></span><span style="color:#660e7a;font-weight:bold;font-style:italic;">  </span><span style="font-style:italic;">include </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">Elasticsearch</span>::<span style="color:#660e7a;font-weight:bold;font-style:italic;">Model<br /></span><span style="color:#660e7a;font-weight:bold;font-style:italic;">  </span><span style="font-style:italic;">include </span><span style="color:#660e7a;font-weight:bold;font-style:italic;">Elasticsearch</span>::<span style="color:#660e7a;font-weight:bold;font-style:italic;">Model</span>::<span style="color:#660e7a;font-weight:bold;font-style:italic;">Callbacks<br /></span><span style="color:#660e7a;font-weight:bold;font-style:italic;"><br /></span><span style="color:#660e7a;font-weight:bold;font-style:italic;">  </span>mapping <span style="color:#660e7a;font-weight:bold;">dynamic</span>: <span style="color:#000080;font-weight:bold;">false do<br /></span><span style="color:#000080;font-weight:bold;">    </span>indexes <span style="color:#660e7a;font-weight:bold;">:title<br /></span><span style="color:#660e7a;font-weight:bold;">    </span>indexes <span style="color:#660e7a;font-weight:bold;">:content<br /></span><span style="color:#660e7a;font-weight:bold;">  </span><span style="color:#000080;font-weight:bold;">end<br /></span><span style="color:#000080;font-weight:bold;">end</span></pre><p>ä¹Ÿå¯ä»¥å®šåˆ¶jsonè¾“å‡ºçš„å†…å®¹ï¼Œæ¯”å¦‚å…³è”è¡¨æ•°æ®ç­‰</p><pre>def as_indexed_json(options={})
   self.as_json(
     only: [:id, :name, :description, :status],   
     include: { tags: { only: [:name]}}
   )
 end<br /></pre><h3><br /></h3><h3>æ‰§è¡Œ</h3><p><br /></p><pre>rake environment elasticsearch:import:model CLASS='Article' FORCE=y<br /></pre><p>æœ€å&lt;/p&gt;<p>bundle install &amp; rake db:migrate</p><p><br /></p><blockquote><p>å°±å¯ä»¥æ„‰å¿«çš„æœç´¢äº†&lt;/p&gt;&lt;/blockquote&gt;<pre style="background-color:#ffffff;color:#000000;font-family:'Menlo';font-size:9.0pt;"><span style="color:#003c5a;font-style:italic;">articles </span>= <span style="color:#660e7a;font-weight:bold;font-style:italic;">Article</span>.search('è‹Ÿåˆ©å›½å®¶ç”Ÿæ­»ä»¥&apos;).results</pre><p><br /></p><p><br /></p><p><br /></p><p><br /></p>
</p></blockquote></p></h3></p></p>
:ET