I"ª<h3><span class="s1">Sessions</span></h3>
<h3><span class="s1"><br /></span></h3>
<p class="p2"><span class="s2">HTTP</span><span class="s1">æ˜¯ä¸€ç§æ— çŠ¶æ€çš„é€šè®¯åè®®ï¼Œä¸ºäº†èƒ½å¤Ÿè®©æµè§ˆå™¨èƒ½å¤Ÿåœ¨è·¨&lt;/span&gt;<span class="s2">request</span> <span class="s1">ä¹‹é—´è®°ä½ä¿¡æ¯ï¼Œ&lt;/span&gt; <span class="s2">Rails</span> <span class="s1">æä¾›äº†&lt;/span&gt; <span class="s2">Session</span> <span class="s1">åŠŸèƒ½ï¼Œåƒæ˜¯è®°ä½ç™»å…¥çš„çŠ¶æ€ã€è®°ä½ç”¨æˆ·è´­ç‰©è½¦çš„å†…å®¹ç­‰ç­‰ï¼Œéƒ½æ˜¯ç”¨&lt;/span&gt; <span class="s2">Session</span> <span class="s1">å®ä½œå‡ºæ¥çš„ã€‚ </span>&lt;/p&gt;<p class="p2"><span class="s1">è¦æ“ä½œ&lt;/span&gt;<span class="s2">Session</span><span class="s1">ï¼Œç›´æ¥æ“ä½œ&lt;/span&gt;<span class="s2">session</span><span class="s1">è¿™ä¸ª </span><span class="s2">Hash</span><span class="s1">å˜é‡å³å¯ã€‚ ä¾‹å¦‚ï¼š&lt;/span&gt;&lt;/p&gt;<pre><span class="s1">session[:cart_id] = @cart.id</span></pre><p class="p4"><span class="s3">Session åŸç†å¯ä»¥å‚è€ƒ <a href="http://en.wikipedia.org/wiki/Session_ID"><span class="s4">Session_ID</span></a>ï¼ŒåŸºæœ¬ä¸Šä¹Ÿæ˜¯åˆ©ç”¨æµè§ˆå™¨çš„</span><span class="s5">cookie</span><span class="s3">æ¥è¿½è¸ª&lt;/span&gt; <span class="s5">requests</span> <span class="s3">è¯·æ±‚ã€‚ </span>&lt;/p&gt;<h4><span class="s1">Session storage</span></h4><h4><span class="s1"><br /></span></h4><p class="p2"><span class="s2">Rails</span><span class="s1">é»˜è®¤é‡‡ç”¨</span> <span class="s2">Cookies session storage</span> <span class="s1">æ¥å‚¨å­˜&lt;/span&gt; <span class="s2">Session</span> <span class="s1">æ•°æ®ï¼Œå®ƒæ˜¯å°†</span> <span class="s2">Session</span> <span class="s1">æ•°æ®é€è¿‡</span> <span class="s2">config/secrets.yml</span> <span class="s1">çš„&lt;/span&gt; <span class="s2">secret_key_base</span> <span class="s1">ç¼–ç åæ”¾åˆ°æµè§ˆå™¨çš„&lt;/span&gt; <span class="s2">Cookie</span> <span class="s1">ä¹‹ä¸­ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯¹æœåŠ¡å™¨çš„æ•ˆèƒ½è´Ÿæ‹…å¾ˆä½ï¼Œç¼ºç‚¹æ˜¯å¤§å°æœ€å¤š&lt;/span&gt; <span class="s2">4Kb</span> <span class="s1">ï¼Œä»¥åŠæ•°æ®è¿˜æ˜¯å¯ä»¥é€è¿‡åç¼–ç åçœ‹å‡ºæ¥ï¼Œåªæ˜¯æ— æ³•è¿›è¡Œä¿®æ”¹ã€‚ å› æ­¤å®‰å…¨æ€§è¾ƒä½ï¼Œä¸é€‚åˆå­˜æ”¾æœºå¯†æ•°æ®ã€‚ </span>&lt;/p&gt;<p class="p6"><span class="s6">é™¤äº†</span><span class="s1">Cookies session storage</span><span class="s6">ï¼Œ&lt;/span&gt;<span class="s1">Rails</span> <span class="s6">ä¹Ÿæ”¯æŒå…¶ä»–æ–¹å¼ï¼Œä½ å¯ä»¥ä¿®æ”¹&lt;/span&gt; <span class="s1">config/initializers/session_store.rb</span> <span class="s6">ï¼š&lt;/span&gt;&lt;/p&gt; <ul class="ul1">
<li class="li6"><span class="s1">:active_record_store</span><span class="s6"> ä½¿ç”¨æ•°æ®åº“æ¥å‚¨å­˜</span></li>
<li class="li6"><span class="s1">:mem_cache_store</span><span class="s6"> ä½¿ç”¨<a href="http://memcached.org/"><span class="s7">Memcached</span></a>å¿«å–ç³»ç»Ÿæ¥å‚¨å­˜ï¼Œé€‚åˆé«˜æµé‡çš„ç½‘ç«™ </span></li>
</ul><p class="p2"><span class="s1">ä¸€èˆ¬æ¥è¯´ä½¿ç”¨é»˜è®¤çš„</span><span class="s2">Cookies session storage</span><span class="s1">å³å¯ï¼Œå¦‚æœå¯¹å®‰å…¨æ€§è¾ƒé«˜è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ®åº“ã€‚ å¦‚æœå¸Œæœ›å…¼é¡¾æ•ˆèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨</span><span class="s2">Memcached</span><span class="s1">ã€‚ </span></p><p class="p6"><span class="s6">é‡‡ç”¨</span><span class="s1">:active_record_store</span><span class="s6">çš„è¯ï¼Œå¿…é¡»å®‰è£…&lt;/span&gt;<span class="s1">activerecord-session_ store gem</span><span class="s6">ï¼Œç„¶åäº§ç”Ÿ&lt;/span&gt;<span class="s1">sessions</span><span class="s6">æ•°æ®è¡¨ï¼š</span>&lt;/p&gt;<pre><span class="s1">$ rails g active_record:session_ migration<br /></span><span class="s1">$ rake db:migrate</span></pre><h3><span class="s1">Cookies</span></h3><h3><span class="s1"><br /></span></h3><p class="p2"> <span class="s1">é™¤äº†</span> <span class="s2">Session</span> <span class="s1">ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œåº•å±‚çš„&lt;/span&gt; <span class="s2">Cookie</span> <span class="s1">ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨èŒƒä¾‹ï¼š</span>&lt;/p&gt; <pre><span class="s1"># Sets a simple session cookie.<br /></span> <span class="s1">cookies[:user_name] = "david"</span></pre> <p class="p7"><span class="s1"></span><br /></p><pre><span class="s1"># Sets a cookie that expires in 1 hour.<br /></span> <span class="s1">cookies[:login] = { :value =&gt; "XJ-122", :expires =&gt; 1.hour.from_now }</span></pre> <p class="p7"><span class="s1"></span><br /></p><pre><span class="s1"># Example for deleting:<br /></span><span class="s1">cookies.delete :user_name</span></pre> <p class="p7"><span class="s1"></span><br /></p><pre><span class="s1">cookies[:key] = {<br /></span><span class="s1">&nbsp;&nbsp; :value =&gt; 'a yummy cookie',<br /></span><span class="s1"> &nbsp;&nbsp; :expires =&gt; 1.year.from_now,<br /></span><span class="s1">&nbsp;&nbsp; :domain =&gt; 'domain.com'<br /></span><span class="s1">}</span></pre><p class="p7"> <span class="s1"></span><br /></p><pre><span class="s1">cookies.delete(:key, :domain =&gt; 'domain.com')</span></pre><p class="p2"><span class="s1">å› ä¸ºæ•°æ®æ˜¯å­˜æ”¾åœ¨ç”¨æˆ·æµè§ˆå™¨ï¼Œ æ‰€ä»¥å¦‚æœéœ€è¦ä¿æŠ¤ä¸èƒ½è®©ç”¨æˆ·ä¹±æ”¹ï¼Œ&lt;/span&gt;<span class="s2">Rails</span><span class="s1">ä¹Ÿæä¾›äº†</span><span class="s2">Signed</span><span class="s1">æ–¹æ³•ï¼š&lt;/span&gt;&lt;/p&gt;<pre><span class="s1"> cookies.signed[:user_preference] = @current_user.preferences</span></pre><p class="p2"><span class="s1">å¦å¤–ï¼Œå¦‚æœæ˜¯å°½å¯èƒ½æ°¸è¿œç•™åœ¨ç”¨æˆ·æµè§ˆå™¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨</span><span class="s2">Permanent </span><span class="s1">æ–¹æ³•ï¼š&lt;/span&gt;&lt;/p&gt;<pre><span class="s1">cookies.permanent[:remember_me] = [current_user.id, current_user.salt]</span></pre><p class="p2"> <span class="s1">ä¸¤è€…ä¹Ÿå¯ä»¥åŠ åœ¨ä¸€èµ·ç”¨ï¼š&lt;/span&gt;&lt;/p&gt; <p></p><pre><span class="s1">cookies.permanent.signed[:remember_me] = [current_user.id, current_user.salt]</span></pre>
</span></p></span></p></span></span></p></span></p></span></span></p></span></span></span></p></span></span></span></span></p></span></p></span></span></span></p></span></span></span></span></p>
:ET